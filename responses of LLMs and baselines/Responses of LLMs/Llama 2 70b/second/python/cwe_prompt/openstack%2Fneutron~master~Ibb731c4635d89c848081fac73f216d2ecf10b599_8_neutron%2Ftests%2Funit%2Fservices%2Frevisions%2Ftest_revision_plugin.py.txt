 No security defects are detected in the code.

However, I would like to point out that the code is quite long and complex, making it challenging to identify potential security vulnerabilities. It would be beneficial to break down the code into smaller, more manageable sections to facilitate a more thorough security review. Additionally, it would be helpful to include comments and documentation to explain the purpose and functionality of each section, which would aid in understanding the code and identifying potential security issues.