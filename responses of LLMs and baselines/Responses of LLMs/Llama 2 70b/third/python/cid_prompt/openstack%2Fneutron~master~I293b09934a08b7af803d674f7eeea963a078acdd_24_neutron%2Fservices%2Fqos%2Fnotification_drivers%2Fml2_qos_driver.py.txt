 No security defects are detected in the code.

However, I would like to point out that the code uses several constants and utility functions that are not defined in the code snippet provided. It would be beneficial to include the entire codebase or provide links to the relevant repositories to ensure a thorough security assessment.

Additionally, I noticed that the code uses a complex structure of function calls and nested if/else statements, which can make it challenging to understand and maintain. It might be worth considering refactoring the code to improve its readability and maintainability.

Overall, while I did not identify any security defects in the provided code snippet, it is essential to keep in mind that security is an ongoing process, and regularly reviewing and updating code is crucial to maintaining the security posture of any software system.